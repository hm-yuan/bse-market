library(WindR)
w.start()
# packages ----------------------------------------------------------------
library(shiny)
library(bs4Dash)
library(tidyverse)
library(shinyWidgets)
library(fontawesome)
library(lubridate)
library(reactable)
library(countup)
library(echarts4r)
library(highcharter)
# pre loading -------------------------------------------------------------
# settings ----------------------------------------------------------------
# 路径设置
PAGE_PATH = "pages/"
# countup time
countup_time = 5
# data --------------------------------------------------------------------
mkt_data = readRDS("data/data_market.rds")
View(mkt_data)
names(mkt_data)
mkt_data %>%
mutate(
year = year(DATETIME),
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
`市值` = round(CLOSE * TOTAL_SHARES/100000000, digits = 2)
) %>%
group_by(month) %>%
summarise(
value = sum(`市值`, na.rm = T)
) |> View()
mkt_data |>
mutate(
year = year(DATETIME),
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
`市值` = round(CLOSE * TOTAL_SHARES/100000000, digits = 2)
) |>
group_by(DATETIME) |>
summarise(
value = sum(`市值`, na.rm = T)
) |> View()
data = mkt_data |>
mutate(
year = year(DATETIME),
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
`市值` = round(CLOSE * TOTAL_SHARES/100000000, digits = 2)
) |>
group_by(DATETIME) |>
summarise(value = sum(`市值`, na.rm = T)) |>
ungroup()
hc_plt = data%>%
hchart("area", hcaes(DATETIME, value), name = "市场市值")  %>%
hc_size(height = 100) %>%
hc_credits(enabled = FALSE) %>%
hc_add_theme(hc_theme_sparkline_vb())
hc_plt
year = year(DATETIME),
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
runApp()
mkt_data |>
mutate(`市值` = CLOSE * TOTAL_SHARES) |>
group_by(DATETIME) |>
summarise(value = round(sum(`市值`, na.rm = T)/100000000, digits = 2)) |>
ungroup()
tail(data)
tail(data$value)
tail(data$value, n = 1)
runApp()
runApp()
help("lubridate")
names(mkt_data)
mkt_data |>
mutate(
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
) |>
group_by(month) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/10000, digits = 2)
)
library(WindR)
w.start()
mkt_data |>
mutate(
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
) |>
group_by(month) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
data = mkt_data |>
mutate(
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
) |>
group_by(month) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
hc_plt = data %>%
hchart("column", hcaes(DATETIME, value), name = "市场市值") |>
hc_size(height = 100) |>
hc_credits(enabled = FALSE) |>
hc_add_theme(hc_theme_sparkline_vb())
hc_plt = data %>%
hchart("column", hcaes(month, value), name = "市场市值") |>
hc_size(height = 100) |>
hc_credits(enabled = FALSE) |>
hc_add_theme(hc_theme_sparkline_vb())
hc_plt
data = mkt_data |>
mutate(
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
) |>
group_by(month) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
data
data %>%
hchart("column", hcaes(month, value), name = "市场成交额") |>
hc_size(height = 100) |>
hc_credits(enabled = FALSE)
data %>%
hchart("column", hcaes(month, value), name = "市场成交额")
names(mkt_data)
head(mkt_data$TURN)
integer(2.3)
trunc(2.3)
trunc(2.7)
data = mkt_data |>
mutate(
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
) |>
group_by(month) |>
summarise(value = round(mean(TURN, na.rm = T), digits = 2))
data |>
hchart("area", hcaes(month, value), name = "市场成交额")
data |> summarise(value = sum(value))
data = mkt_data |>
mutate(
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
) |>
group_by(month) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
data |> summarise(value = sum(value))
data = mkt_data |>
mutate(
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME))),
) |>
group_by(month) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
data
mkt_data |>
filter(DATETIME >= as.Date("2021-11-15")) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
data_x = mkt_data |>
filter(DATETIME >= as.Date("2021-11-15")) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
data_x[[1]]
month = paste0(year(DATETIME), "-", ifelse(month(DATETIME) <10, paste0("0", month(DATETIME)), month(DATETIME)))
names(mkt_data)
data = mkt_data |>
filter(`AMT` != 0) |>
filter(`DATETIME`> as.Date("2022-02-09")) |>
mutate(流通市值 = `CLOSE`*`SHARE_TOTALTRADABLE`) |>
group_by(`DATETIME`) |>
summarise(
day_amt = sum(`AMT`, na.rm = T),
day_mkt = sum(`流通市值`, na.rm = T)
) |>
mutate(
change_rate = round(day_amt/day_mkt*10000, digits = 4)
) |>
ungroup() |>
summarise(
avg_rate = median(change_rate, na.rm = T)
)
data
mkt_data |>
filter(`AMT` != 0) |>
filter(`DATETIME`>= as.Date("2021-11-15")) |>
mutate(流通市值 = `CLOSE`*`SHARE_TOTALTRADABLE`) |>
group_by(`DATETIME`) |>
summarise(
day_amt = sum(`AMT`, na.rm = T),
day_mkt = sum(`流通市值`, na.rm = T)
) |>
mutate(
change_rate = round(day_amt/day_mkt*10000, digits = 4)
) |>
ungroup()
data = mkt_data |>
filter(`AMT` != 0) |>
filter(`DATETIME`>= as.Date("2021-11-15")) |>
mutate(流通市值 = `CLOSE`*`SHARE_TOTALTRADABLE`) |>
group_by(`DATETIME`) |>
summarise(
day_amt = sum(`AMT`, na.rm = T),
day_mkt = sum(`流通市值`, na.rm = T)
) |>
mutate(
turnover_rate = round(day_amt/day_mkt, digits = 4)
) |>
ungroup()
data
data = mkt_data |>
filter(`AMT` != 0) |>
filter(`DATETIME`>= as.Date("2021-11-15")) |>
mutate(流通市值 = `CLOSE`*`SHARE_TOTALTRADABLE`) |>
group_by(`DATETIME`) |>
summarise(
day_amt = sum(`AMT`, na.rm = T),
day_mkt = sum(`流通市值`, na.rm = T)
) |>
mutate(
turnover_rate = round(day_amt/day_mkt*100, digits = 4)
) |>
ungroup()
data
trunc(2.2)
2.32-trunc(2.32)
(2.32-trunc(2.32))*100
data
tail(data$turnover_rate, n =1)
data |>
hchart("area", hcaes(month, value), name = "换手率")
data |>
hchart("area", hcaes(DATETIME, value), name = "换手率")
data = mkt_data |>
filter(`AMT` != 0) |>
filter(`DATETIME`>= as.Date("2021-11-15")) |>
mutate(流通市值 = `CLOSE`*`SHARE_TOTALTRADABLE`) |>
group_by(`DATETIME`) |>
summarise(
day_amt = sum(`AMT`, na.rm = T),
day_mkt = sum(`流通市值`, na.rm = T)
) |>
mutate(
turnover_rate = round(day_amt/day_mkt*100, digits = 2)
) |>
ungroup()
data |>
hchart("area", hcaes(DATETIME, turnover_rate), name = "换手率")
View(data)
data = mkt_data |>
filter(`AMT` != 0) |>
mutate(流通市值 = `CLOSE`*`SHARE_TOTALTRADABLE`) |>
group_by(`DATETIME`) |>
summarise(
day_amt = sum(`AMT`, na.rm = T),
day_mkt = sum(`流通市值`, na.rm = T)
) |>
mutate(
turnover_rate = round(day_amt/day_mkt*100, digits = 2)
) |>
ungroup()
View(data)
data |>
filter(`DATETIME`>= as.Date("2021-11-15")) |>
summarise(
value = round(mean(turnover_rate), digits = 2)
)
data |>
hchart("area", hcaes(DATETIME, turnover_rate), name = "市场整体换手率")
data_x = data |>
filter(`DATETIME`>= as.Date("2021-11-15")) |>
summarise(
value = round(mean(turnover_rate), digits = 2)
)
data_x
trunc(data_x$value[[1]]
trunc(data_x$value[[1]])
(data_x$value[[1]] - trunc(data_x$value[[1]]))*100
runApp()
data = mkt_data |>
mutate(`市值` = CLOSE * TOTAL_SHARES) |>
group_by(DATETIME) |>
summarise(value = round(sum(`市值`, na.rm = T)/100000000, digits = 2)) |>
ungroup()
data$DATETIME |> tail(n= 1)
data = mkt_data |>
filter(`AMT` != 0) |>
filter(`DATETIME`>= as.Date("2020-11-15")) |>
mutate(流通市值 = `CLOSE`*`SHARE_TOTALTRADABLE`) |>
group_by(`DATETIME`) |>
summarise(
day_amt = sum(`AMT`, na.rm = T),
day_mkt = sum(`流通市值`, na.rm = T)
) |>
mutate(
turnover_rate = round(day_amt/day_mkt*100, digits = 2)
) |>
ungroup()
hc_plt = data |>
hchart("area", hcaes(DATETIME, turnover_rate), name = "市场整体换手率") |>
hc_size(height = 100) |>
hc_credits(enabled = FALSE) |>
hc_add_theme(hc_theme_sparkline_vb())
hc_plt
data |>
hchart("area", hcaes(DATETIME, turnover_rate), name = "市场整体换手率")
runApp()
data = mkt_data |>
group_by(DATETIME) |>
summarise(
value = round(sum(AMOUNT_BTIN, na.rm = T)/100000000, digits = 2)
)
data
data |>
hchart("column", hcaes(DATETIME, value), name = "市场成交额")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
library(openxlsx)
firm_info = read.xlsx("firm_info", detectDates = T)
# packages ----------------------------------------------------------------
library(shiny)
library(bs4Dash)
library(tidyverse)
library(openxlsx)
library(shinyWidgets)
library(fontawesome)
library(lubridate)
library(reactable)
library(countup)
library(echarts4r)
library(highcharter)
# pre loading -------------------------------------------------------------
# settings ----------------------------------------------------------------
# 路径设置
PAGE_PATH = "pages/"
# countup time
countup_time = 5
# data --------------------------------------------------------------------
mkt_data = readRDS("data/data_market.rds")
firm_info = read.xlsx("firm_info", detectDates = T)
firm_info = read.xlsx("data/firm_info.xlsx", detectDates = T)
View(firm_info)
firm_info$名称
runApp()
firm_info$名称 |> unlist()
runApp()
